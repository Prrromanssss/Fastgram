{% load static %}
<div class="container mt-3">
    {% with request.resolver_match.view_name as view_name %}
        {% if view_name == 'response:list_responses' %}
            {% ifchanged %}
                  <br>
                  <h4>Пользователь: {{ response.user.email }}</h4>
            {% endifchanged %}
        {% else %}
        {% endif %}
    {% endwith %}
  
  <div class="card mb-3">
      {% with request.resolver_match.view_name as view_name %}
          {% if view_name != 'response:list_responses' %}
              <div class="card-header">Пользователь: {{ response.user.email }}</div>
          {% endif %}
      {% endwith %}
  
    <div class="card-body text-dark">
      <h5 class="card-title">{{ response.name }}</h5>
        Курьерская служба: {{ response.delivery.name }}
          {% with request.resolver_match.view_name as view_name %}
                {% if response.text|slice:":3" != '<p>' %}
                  <p>{{ response.text|safe|truncatewords:10 }}</p>
                {% else %}
                    {{ response.text|safe|truncatewords:10 }}
                {% endif %}
          {% endwith %}
    </div>

    <div>
      <div class="d-inline-block p-1 mx-2 block">
        <form action={% url 'response:like' response_id=response.id %} method="post" class="d-inline-block">
            {% csrf_token %}
            <button type="submit" class="border-0 button">
              {% if user in response.get_likes %}
                <img class="image" src={% static 'img/like_red.png' %} alt="Лайк!">
              {% else %}
                <img class="image" src={% static 'img/like.png' %} alt="Лайк!">
              {% endif %}
            </button>
        </form>
      <div class="text-black d-inline-block">{{ response.likes.count }}</div>
    </div>
    
    <div class="d-inline-block p-1 mx-2">
      <button
        type="button"
        class="btn btn-dark text-nowrap"
        data-bs-toggle="modal"
        data-bs-target="#modal-comment">
        комментарии
      </button>
      <div
      class="modal fade"
      id="modal-comment"
      tabindex="-1"
      aria-labelledby="commentModalLabel"
      aria-hidden="true">
        <div class="modal-dialog modal-xl">
          <div class="modal-content">
            <div class="modal-header bg-dark text-white">
              <h5 class="modal-title" id="commentModalLabel">
                Комментарии
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close">
              </button>
            </div>
            <div class="modal-body text-dark">
              <div>
                {% for i in response.get_comments %}
                  <div class="border border-2 rounded border-dark p-3 mb-3">
                    <h6 class="border-bottom pb-2">{{ i.user }}</h3>
                    <p>{{ i.text }}</p>
                  </div>
                {% endfor %}
              </div>
              <form method="post" action="{% url 'response:comment' response_id=response.id %}">
                {% csrf_token %}
                {{ comments_form.as_p }}
                <button type="submit" name="comment" class="btn btn-dark mx-sm-3 w-25 ">
                  Опубликовать
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  </div>
</div>
